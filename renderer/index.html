<!DOCTYPE html>
<html lang="es-Mx">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Alfred - Asistente Personal</title>
    <link rel="stylesheet" href="./styles/main.css">
</head>

<body>
    <!-- Overlay de carga del backend -->
    <div class="backend-loading-overlay" id="backendLoadingOverlay">
        <div class="backend-loading-content">
            <div class="loading-spinner"></div>
            <h2>Iniciando Alfred</h2>
            <p id="loadingStatusText">Conectando con el backend...</p>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgressBar"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Bienvenida (Primera vez) -->
    <div class="modal-overlay" id="firstTimeWelcomeModal" style="display: none;">
        <div class="first-time-modal">
            <div class="first-time-modal-icon">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </div>
            <h2>Bienvenido a Alfred</h2>
            <p class="first-time-subtitle">Cuentanos un poco sobre ti (todo es opcional)</p>
            
            <div class="first-time-content">
                <div class="form-group">
                    <label for="welcomeName">Tu nombre</label>
                    <input type="text" id="welcomeName" placeholder="Ejemplo: Juan Perez" maxlength="100">
                </div>

                <div class="form-group">
                    <label for="welcomeAge">Tu edad</label>
                    <input type="number" id="welcomeAge" placeholder="Ejemplo: 25" min="1" max="120">
                </div>

                <div class="form-group">
                    <label>Foto de perfil</label>
                    <div class="profile-picture-upload">
                        <div class="profile-picture-preview" id="welcomeProfilePreview">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                        </div>
                        <input type="file" id="welcomeProfileInput" accept="image/*" style="display: none;">
                        <button class="button secondary small" onclick="document.getElementById('welcomeProfileInput').click()">
                            Seleccionar foto
                        </button>
                    </div>
                </div>
            </div>

            <div class="first-time-actions">
                <button class="button primary large" id="welcomeContinueBtn">
                    Continuar
                </button>
                <button class="button secondary large" id="welcomeSkipBtn">
                    Omitir
                </button>
            </div>

            <p class="first-time-note">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                Toda esta informacion es opcional y puede ser modificada despues en Configuracion
            </p>
        </div>
    </div>

    <!-- Modal de primera instalacion (Cifrado) -->
    <div class="modal-overlay" id="firstTimeEncryptionModal" style="display: none;">
        <div class="first-time-modal">
            <div class="first-time-modal-icon">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </div>
            <h2>Bienvenido a Alfred</h2>
            <p class="first-time-subtitle">Configuracion inicial de seguridad</p>
            
            <div class="first-time-content">
                <div class="info-card">
                    <div class="info-card-icon success">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </div>
                    <div>
                        <h3>Cifrado de datos</h3>
                        <p>Protege tus conversaciones y datos personales con cifrado AES-256. Si pierdes la clave, no podras recuperar tu informacion.</p>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-icon warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3>Sin cifrado</h3>
                        <p>Tus datos se guardaran en texto plano. Mas rapido pero menos seguro. Puedes cambiar esto despues en Configuracion.</p>
                    </div>
                </div>
            </div>

            <div class="first-time-actions">
                <button class="button primary large" id="firstTimeEnableEncryption">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Habilitar cifrado (Recomendado)
                </button>
                <button class="button secondary large" id="firstTimeDisableEncryption">
                    Continuar sin cifrado
                </button>
            </div>

            <p class="first-time-note">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                Podras cambiar esta configuracion en cualquier momento desde Configuracion â†’ Seguridad
            </p>
        </div>
    </div>

    <!-- Barra superior -->
    <div class="topbar">
        <div class="topbar-left">
            <button class="icon-button menu-toggle" id="menuToggle" title="Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18" />
                </svg>
            </button>
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="14" fill="#4a9eff" opacity="0.2" />
                    <path d="M16 8L20 14H12L16 8Z" fill="#4a9eff" />
                    <circle cx="16" cy="18" r="3" fill="#4a9eff" />
                    <path d="M16 21V26" stroke="#4a9eff" stroke-width="2" />
                </svg>
                <h1><span>Alfred</span></h1>
            </div>
            <div>
                <h1 class="separator-vertical"></h1>
            </div>
            <div class="mode-indicator" id="modeIndicator">
                <span class="mode-name">Work</span>
            </div>
        </div>
        <div class="topbar-right">
            <div class="model-selector">
                <select id="modelSelect" class="model-select">
                    <option value="">Cargando modelos...</option>
                </select>
            </div>
            <div class="status" id="status">
                <span class="status-dot"></span>
                <span class="status-text">Conectando...</span>
            </div>
            <button class="icon-button" onclick="stopOllama()" title="Detener Ollama (liberar recursos)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <rect x="9" y="9" width="6" height="6" />
                </svg>
            </button>
            <button class="icon-button" onclick="restartBackend()" title="Reiniciar servidor">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16" />
                </svg>
            </button>
            <div class="profile-picture-topbar" id="profilePictureTopbar" title="Perfil">
                <span class="default-avatar">ðŸ‘¤</span>
            </div>
        </div>
    </div>

    <!-- Contenedor principal -->
    <div class="container">
        <!-- Sidebar izquierdo (menu) -->
        <div class="left-sidebar" id="leftSidebar">
            <nav class="left-sidebar-nav">
                <button class="nav-item" id="newChatBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                    <span>Nueva conversacion</span>
                </button>
                <button class="nav-item" id="conversationsBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" />
                    </svg>
                    <span>Conversaciones</span>
                </button>
                <button class="nav-item" id="historyBtn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M10 3a7 7 0 100 14 7 7 0 000-14zm0 12a5 5 0 110-10 5 5 0 010 10zm1-8H9v4l3.5 2.1.7-1.2-2.2-1.3V7z" />
                    </svg>
                    <span>Historial</span>
                </button>
                <button class="nav-item" id="settingsBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
                    </svg>
                    <span>ConfiguraciÃ³n</span>
                </button>
            </nav>

            <!-- Selector de Modo -->
            <div class="mode-selector">
                <div class="mode-selector-header">
                    <span>Modo</span>
                </div>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="work" title="Modo Trabajo">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z" />
                        </svg>
                        <span>Work</span>
                    </button>
                    <button class="mode-btn" data-mode="focus" title="Modo Concentracion">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6z" />
                        </svg>
                        <span>Focus</span>
                    </button>
                    <button class="mode-btn" data-mode="personal" title="Modo Personal">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                        <span>Personal</span>
                    </button>
                    <button class="mode-btn" data-mode="creative" title="Modo Creativo">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z" />
                        </svg>
                        <span>Creative</span>
                    </button>
                </div>
            </div>

            <!-- Contenido dinamico del sidebar -->
            <div class="left-sidebar-content" id="leftSidebarContent">
                <!-- Aqui se mostrara el contenido de conversaciones, historial o estadisticas -->
            </div>
        </div>

        <!-- Ãrea de chat -->
        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="welcome-message">
                    <div class="welcome-icon">ðŸ¤–</div>
                    <h2>Â¡Hola! Soy Alfred</h2>
                    <p>Tu asistente personal inteligente</p>
                    <p class="welcome-subtitle">PregÃºntame cualquier cosa sobre tus documentos</p>
                </div>
            </div>

            <!-- Indicador de escritura -->
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span>Alfred estÃ¡ escribiendo...</span>
            </div>

            <!-- Input de mensaje -->
            <div class="input-container">
                <div>
                    <textarea id="messageInput" placeholder="Escribe tu mensaje aquÃ­..." rows="1"
                        autocomplete="off"></textarea>
                    <div class="input-actions">
                        <button id="attachFileBtn" class="icon-button" title="Adjuntar documento temporal">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/>
                            </svg>
                        </button>
                        <input type="file" id="fileInput" style="display: none;" accept=".txt,.pdf,.docx,.xlsx,.pptx,.md,.json,.xml,.csv" />
                        <button id="searchDocsBtn" class="mode-toggle-btn" title="Buscar en documentos">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                            </svg>
                            <span>Documentos</span>
                        </button>
                        <button id="promptOnlyBtn" class="mode-toggle-btn active" title="Solo usar el prompt">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" />
                            </svg>
                            <span>Prompt</span>
                        </button>
                        <button id="sendBtn" class="send-button" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Indicador de archivo adjunto -->
                <div class="attached-file-indicator" id="attachedFileIndicator" style="display: none;">
                    <div class="attached-file-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6z"/>
                        </svg>
                        <span class="file-name" id="attachedFileName"></span>
                        <span class="file-size" id="attachedFileSize"></span>
                    </div>
                    <button class="remove-file-btn" id="removeFileBtn" title="Quitar archivo">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de configuraciÃ³n -->
    <div class="modal none" id="settingsModal">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h2>ConfiguraciÃ³n</h2>
                <button class="icon-button" id="closeSettings">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M15.898 4.045c-.269-.27-.706-.27-.975 0l-4.923 4.923-4.923-4.923c-.27-.27-.706-.27-.975 0s-.27.706 0 .975l4.923 4.923-4.923 4.923c-.27.27-.27.706 0 .975.135.135.312.203.488.203s.353-.068.488-.203l4.923-4.923 4.923 4.923c.135.135.312.203.488.203s.353-.068.488-.203c.27-.269.27-.706 0-.975l-4.923-4.923 4.923-4.923c.27-.269.27-.706 0-.975z" />
                    </svg>
                </button>
            </div>
            <div class="settings-container">
                <!-- Menu lateral de configuraciones -->
                <div class="settings-sidebar">
                    <nav class="settings-nav">
                        <button class="settings-nav-item active" data-section="perfil">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>Perfil</span>
                        </button>
                        <button class="settings-nav-item" data-section="modelos">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                <line x1="12" y1="17" x2="12" y2="21"></line>
                            </svg>
                            <span>Modelos</span>
                        </button>
                        <button class="settings-nav-item" data-section="personalizacion">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v6M12 18v4M4.93 4.93l4.24 4.24M14.83 14.83l4.24 4.24M2 12h6M18 12h4M4.93 19.07l4.24-4.24M14.83 9.17l4.24-4.24"></path>
                            </svg>
                            <span>PersonalizaciÃ³n</span>
                        </button>
                        <button class="settings-nav-item" data-section="documentos">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                <polyline points="13 2 13 9 20 9"></polyline>
                            </svg>
                            <span>Documentos</span>
                        </button>
                        <button class="settings-nav-item" data-section="aplicaciones">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                            <span>Aplicaciones</span>
                        </button>
                        <button class="settings-nav-item" data-section="seguridad">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            <span>Seguridad</span>
                        </button>
                    </nav>
                </div>

                <!-- Contenido de configuraciones -->
                <div class="settings-content">
                    <!-- Seccion Perfil -->
                    <div class="settings-section active" data-section="perfil">
                        <h3 class="section-title">Perfil</h3>
                        
                        <!-- Informacion personal -->
                        <div class="setting-group">
                            <label for="userName">Nombre</label>
                            <input type="text" id="userName" placeholder="Ingresa tu nombre" maxlength="100">
                            <small>Alfred usara tu nombre para personalizar las conversaciones</small>
                        </div>

                        <div class="setting-group">
                            <label for="userAge">Edad</label>
                            <input type="number" id="userAge" placeholder="Ingresa tu edad" min="1" max="150">
                            <small>Ayuda a Alfred a dar respuestas mas personalizadas</small>
                        </div>

                        <div class="setting-group">
                            <button class="button primary" id="saveUserInfoBtn">Guardar informacion personal</button>
                        </div>
                        
                        <div class="setting-group profile-section">
                            <label>Foto de perfil</label>
                            <div class="profile-picture-container">
                                <div class="current-profile-picture" id="currentProfilePicture">
                                    <span class="default-avatar">ðŸ‘¤</span>
                                </div>
                                <div class="profile-actions">
                                    <button class="button secondary" id="changeProfilePictureBtn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path
                                                d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                                        </svg>
                                        Cambiar foto
                                    </button>
                                </div>
                            </div>

                            <!-- Historial de fotos de perfil -->
                            <div class="profile-history-section">
                                <div class="profile-history-header">
                                    <h4>Historial de fotos</h4>
                                    <span class="profile-history-count" id="profileHistoryCount">0 fotos</span>
                                </div>
                                <div class="profile-history-gallery" id="profileHistoryGallery">
                                    <div class="no-history-message">
                                        No hay fotos en el historial
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label for="serverUrl">URL del servidor Alfred</label>
                            <input type="text" id="serverUrl" value="http://127.0.0.1:8000" />
                        </div>

                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="autoSave" checked />
                                Guardar conversaciones automaticamente
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="useHistory" checked />
                                Buscar en historial primero
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="soundEnabled" />
                                Habilitar sonidos
                            </label>
                        </div>
                    </div>

                    <!-- Seccion Modelos -->
                    <div class="settings-section" data-section="modelos">
                        <h3 class="section-title">Modelos</h3>

                        <!-- Lista de modelos instalados -->
                        <div class="setting-group">
                            <div class="models-header">
                                <label>Modelos instalados</label>
                                <button class="button secondary" id="refreshModelsBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="23 4 23 10 17 10"></polyline>
                                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                    </svg>
                                    Actualizar
                                </button>
                            </div>
                            <div id="modelsList" class="models-list">
                                <div class="loading-models">
                                    <div class="loading-spinner"></div>
                                    <span>Cargando modelos...</span>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label for="downloadModel">Descargar modelo</label>
                            <div class="download-model-controls">
                                <input type="text" id="downloadModel" placeholder="Nombre del modelo (ej: llama3.2:3b, mistral)" />
                                <button class="button primary" id="downloadModelBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Descargar
                                </button>
                            </div>
                            <p class="setting-description">
                                Ingresa el nombre del modelo de Ollama que deseas descargar. Ejemplos: llama3.2:3b, mistral, gemma2:9b
                            </p>
                            <!-- Lista de descargas en progreso -->
                            <div id="downloadProgress" class="download-progress-container" style="display: none;">
                                <div class="download-progress-header">
                                    <label>Descargas en progreso</label>
                                </div>
                                <div id="downloadProgressList" class="download-progress-list"></div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label for="ollamaKeepAlive">Tiempo de inactividad de Ollama</label>
                            <div class="keep-alive-controls">
                                <input type="range" id="ollamaKeepAlive" min="0" max="1800" value="30" step="30" />
                                <div class="keep-alive-display">
                                    <span id="ollamaKeepAliveValue">30</span> segundos
                                </div>
                            </div>
                            <p class="setting-description">
                                Tiempo que Ollama mantiene el modelo en memoria despues de usarlo.
                                Valores mas bajos liberan memoria mas rapido, valores mas altos mejoran la velocidad de
                                respuesta.
                            </p>
                            <div class="keep-alive-presets">
                                <button class="preset-btn" data-seconds="0">Inmediato (0s)</button>
                                <button class="preset-btn" data-seconds="30">Rapido (30s)</button>
                                <button class="preset-btn" data-seconds="300">Normal (5min)</button>
                                <button class="preset-btn" data-seconds="1800">Largo (30min)</button>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label for="modelTone">Tono del modelo</label>
                            <select id="modelTone">
                                <option value="profesional">Profesional</option>
                                <option value="casual">Casual</option>
                                <option value="tecnico">Tecnico</option>
                                <option value="creativo">Creativo</option>
                                <option value="amigable">Amigable</option>
                            </select>
                            <p class="setting-description">
                                Define el estilo de comunicacion del asistente.
                            </p>
                        </div>
                    </div>

                    <!-- Seccion Personalizacion -->
                    <div class="settings-section" data-section="personalizacion">
                        <h3 class="section-title">PersonalizaciÃ³n</h3>

                        <div class="setting-group">
                            <label for="assistantName">Nombre del asistente</label>
                            <input type="text" id="assistantName" placeholder="Alfred" value="Alfred" />
                            <p class="setting-description">
                                Personaliza como quieres llamar a tu asistente.
                            </p>
                        </div>

                        <div class="setting-group">
                            <label for="customInstructions">Instrucciones personalizadas</label>
                            <textarea id="customInstructions" rows="4" placeholder="Instrucciones especificas para el asistente..."></textarea>
                            <p class="setting-description">
                                Instrucciones que el asistente seguira en todas las conversaciones.
                            </p>
                        </div>

                        <div class="setting-group">
                            <label for="userOccupation">Ocupacion</label>
                            <input type="text" id="userOccupation" placeholder="Desarrollador, DiseÃ±ador, Estudiante..." />
                            <p class="setting-description">
                                Ayuda al asistente a entender tu contexto profesional.
                            </p>
                        </div>

                        <div class="setting-group">
                            <label for="aboutUser">Acerca de ti</label>
                            <textarea id="aboutUser" rows="3" placeholder="Cuentale al asistente sobre ti, tus intereses, objetivos..."></textarea>
                            <p class="setting-description">
                                Esta informacion ayudara al asistente a personalizar sus respuestas.
                            </p>
                        </div>

                        <div class="setting-group">
                            <button id="savePersonalizationBtn" class="button primary">Guardar Personalizacion</button>
                        </div>
                    </div>

                    <!-- Seccion Documentos -->
                    <div class="settings-section" data-section="documentos">
                        <h3 class="section-title">Documentos</h3>
                        <p class="section-description">Gestiona las rutas de documentos para el sistema de busqueda RAG y la indexacion de embeddings.</p>

                        <!-- Paths de documentos -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label>Rutas de documentos</label>
                                <button class="button-icon" id="addDocPathBtn" title="Agregar nueva ruta">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                </button>
                            </div>
                            <small>Carpetas donde Alfred buscara documentos para responder tus preguntas</small>
                            
                            <div id="docPathsList" class="doc-paths-list">
                                <!-- Lista dinamica de paths -->
                            </div>
                        </div>

                        <!-- Estado de indexacion -->
                        <div class="setting-group">
                            <label>Estado de indexacion</label>
                            <div class="indexation-status" id="indexationStatus">
                                <div class="status-item">
                                    <span class="status-label">Documentos indexados:</span>
                                    <span class="status-value" id="indexedDocsCount">0</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Fragmentos (chunks):</span>
                                    <span class="status-value" id="chunksCount">0</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Vectores:</span>
                                    <span class="status-value" id="vectorsCount">0</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Ultima actualizacion:</span>
                                    <span class="status-value" id="lastIndexUpdate">Nunca</span>
                                </div>
                            </div>
                        </div>

                        <!-- Acciones de indexacion -->
                        <div class="setting-group">
                            <label>Acciones de indexacion</label>
                            <div class="action-buttons">
                                <button class="button primary" id="reindexDocsBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="23 4 23 10 17 10"></polyline>
                                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                    </svg>
                                    Reindexar documentos
                                </button>
                                <button class="button secondary" id="clearIndexBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Limpiar indice
                                </button>
                            </div>
                            <small>La reindexacion puede tardar varios minutos dependiendo del numero de documentos</small>
                        </div>

                        <!-- Configuracion avanzada -->
                        <div class="setting-group">
                            <label>Configuracion de embeddings</label>
                            <div class="advanced-settings">
                                <div class="setting-row">
                                    <span>Modelo de embeddings:</span>
                                    <span class="setting-value" id="embeddingModelName">nomic-embed-text:v1.5</span>
                                </div>
                                <div class="setting-row">
                                    <span>Tamano de chunk:</span>
                                    <input type="number" id="chunkSize" value="1000" min="100" max="5000" step="100" class="input-small">
                                    <small>caracteres</small>
                                </div>
                                <div class="setting-row">
                                    <span>Overlap de chunks:</span>
                                    <input type="number" id="chunkOverlap" value="200" min="0" max="1000" step="50" class="input-small">
                                    <small>caracteres</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seccion Aplicaciones -->
                    <div class="settings-section" data-section="aplicaciones">
                        <h3 class="section-title">Aplicaciones conectadas</h3>
                        <p class="section-description">Conecta tus aplicaciones favoritas para extender las capacidades de Alfred.</p>

                        <div class="apps-grid">
                            <div class="app-card">
                                <div class="app-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM5 8V6h14v2H5z"/>
                                    </svg>
                                </div>
                                <div class="app-info">
                                    <h4>Google Calendar</h4>
                                    <p>Gestiona tu agenda y eventos</p>
                                </div>
                                <button class="button secondary app-connect-btn">Conectar</button>
                            </div>

                            <div class="app-card">
                                <div class="app-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                                    </svg>
                                </div>
                                <div class="app-info">
                                    <h4>Tidal</h4>
                                    <p>Control de musica y playlists</p>
                                </div>
                                <button class="button secondary app-connect-btn">Conectar</button>
                            </div>

                            <div class="app-card">
                                <div class="app-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM5 7h14v2H5zm0 4h14v2H5zm0 4h7v2H5z"/>
                                    </svg>
                                </div>
                                <div class="app-info">
                                    <h4>Notion</h4>
                                    <p>Sincroniza tus notas y tareas</p>
                                </div>
                                <button class="button secondary app-connect-btn">Conectar</button>
                            </div>

                            <div class="app-card">
                                <div class="app-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
                                    </svg>
                                </div>
                                <div class="app-info">
                                    <h4>Gmail</h4>
                                    <p>Gestiona tu correo electronico</p>
                                </div>
                                <button class="button secondary app-connect-btn">Conectar</button>
                            </div>

                            <div class="app-card">
                                <div class="app-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                                    </svg>
                                </div>
                                <div class="app-info">
                                    <h4>Trello</h4>
                                    <p>Organiza tus proyectos</p>
                                </div>
                                <button class="button secondary app-connect-btn">Conectar</button>
                            </div>

                            <div class="app-card">
                                <div class="app-icon">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                    </svg>
                                </div>
                                <div class="app-info">
                                    <h4>Slack</h4>
                                    <p>Integracion con tu equipo</p>
                                </div>
                                <button class="button secondary app-connect-btn">Conectar</button>
                            </div>
                        </div>
                    </div>

                    <!-- Seccion Seguridad -->
                    <div class="settings-section" data-section="seguridad">
                        <h3 class="section-title">Seguridad y privacidad</h3>
                        <p class="section-description">Gestiona el cifrado de tus datos personales y conversaciones.</p>

                        <!-- Alerta de primera configuracion -->
                        <div class="security-first-setup" id="securityFirstSetup" style="display: none;">
                            <div class="alert alert-info">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                <div>
                                    <h4>Primera configuracion de seguridad</h4>
                                    <p>Alfred puede cifrar tus conversaciones y datos personales para mayor seguridad. Te recomendamos habilitar el cifrado.</p>
                                </div>
                            </div>
                            <div class="first-setup-options">
                                <button class="button primary" id="enableEncryptionBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                    Habilitar cifrado (Recomendado)
                                </button>
                                <button class="button secondary" id="disableEncryptionBtn">
                                    Continuar sin cifrado
                                </button>
                            </div>
                        </div>

                        <!-- Estado de cifrado -->
                        <div class="security-status" id="securityStatus">
                            <div class="setting-group">
                                <div class="security-status-header">
                                    <div class="status-badge" id="encryptionStatusBadge">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                        </svg>
                                        <span id="encryptionStatusText">Cifrado habilitado</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Clave de cifrado -->
                            <div class="setting-group" id="encryptionKeyGroup">
                                <label>Clave de cifrado</label>
                                <div class="encryption-key-container">
                                    <input type="password" id="encryptionKeyField" readonly class="encryption-key-field" value="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                                    <button class="icon-button" id="toggleEncryptionKeyBtn" title="Mostrar/Ocultar clave">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="eyeIcon">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                    <button class="icon-button" id="reloadEncryptionKeyBtn" title="Recargar clave">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23 4 23 10 17 10"></polyline>
                                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                        </svg>
                                    </button>
                                    <button class="icon-button" id="copyEncryptionKeyBtn" title="Copiar clave">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                                <div class="alert alert-warning">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                        <line x1="12" y1="9" x2="12" y2="13"></line>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                    <div>
                                        <strong>IMPORTANTE: Guarda esta clave en un lugar seguro</strong>
                                        <p>Si pierdes esta clave, no podras recuperar tus datos cifrados. No podemos recuperarla por ti.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Toggle de cifrado -->
                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="encryptionToggle" disabled>
                                    Cifrar nuevos datos
                                </label>
                                <small>Los datos existentes no se vuelven a cifrar. Solo afecta datos nuevos.</small>
                            </div>
                        </div>

                        <!-- Informacion adicional -->
                        <div class="setting-group">
                            <h4>Â¿Que se cifra?</h4>
                            <ul class="security-info-list">
                                <li>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Conversaciones y mensajes
                                </li>
                                <li>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Datos personales extraidos (RFC, CURP, NSS, etc.)
                                </li>
                                <li>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Historial de consultas y respuestas
                                </li>
                            </ul>
                        </div>

                        <div class="setting-group">
                            <h4>Â¿Que NO se cifra?</h4>
                            <ul class="security-info-list">
                                <li>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    Documentos indexados (permanecen en su ubicacion original)
                                </li>
                                <li>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    Indices de vectores (no contienen texto completo)
                                </li>
                                <li>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    Configuracion de la aplicacion
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="button secondary" id="cancelSettings">Cancelar</button>
                <button class="button primary" id="saveSettings">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Scripts modulares -->
    <script type="module" src="./renderer.js"></script>
</body>

</html>